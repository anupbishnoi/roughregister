</textarea>
    </form>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/bootstrap-markdown.js"></script>
    <script src="../js/jquery.hotkeys.js"></script>
    <script src="../js/humane.js"></script>
    <script>
      (function () {
        var el = $('#writebox');
        el.markdown({
          autofocus: true,
          savable: true,
          onSave: save,
          hiddenButtons: 'cmdPreview',
          additionalButtons: [
            [{
              name: "groupCustom",
              data: [{
                name: "cmdView",
                toggle: true,
                title: "View",
                icon: "glyphicon glyphicon-eye-open",
                callback: function(e){
                  window.open('.');
                }
              }]
            }]
          ]
        });
        var editor = el.data('markdown');
        editor.setFullscreen(true);
        editor.setFullscreen = function () {};
        editor.savedContent = editor.getContent();
        
        el.bind('keydown', 'ctrl+s', save);
        el.bind('keydown', 'meta+s', save);
        
        var humane = window.humane;
        humane.baseCls = 'humane-libnotify';
        humane.error = humane.spawn({ addnCls: 'humane-libnotify-error' })
        
        function save(e) {
          var content = editor.getContent();
          if (content === editor.savedContent) {
            if (e) window.humane.log('Already saved');
            return false;
          }
          $.post('save', {
            content: content,
            previousContent: editor.savedContent
          }, function () {
            editor.savedContent = content;
            if (e) humane.log('Saved');
          }).fail(function (res) {
            humane.error(res.statusText + '\nReload page');
          });
          return false;
        }
        
        setInterval(save, 10000);
        
        $(window).on("beforeunload", function (e) {
          if (editor.getContent() === editor.savedContent) {
            return;
          }
          var confirmationMessage = "Unsaved changes!";
          (e || window.event).returnValue = confirmationMessage;
          return confirmationMessage;
        });
        
        $('body').animate({
          opacity: 1
        });
        
        var locationParts = location.href.split('/'),
          topicName = locationParts[locationParts.length - 2];
        $('title').text($('title').text() + ': ' + topicName);
        
        $(window).resize(resize);
        resize();
        function resize() {
          var maxWidth = 800,
            minPadding = 30,
            padding = Math.max(parseInt(($(window).width() - maxWidth) / 2, 10), minPadding);
          $('#writebox').each(function () {
              this.style.setProperty('padding-left', padding + 'px', 'important');
              this.style.setProperty('padding-right', padding + 'px', 'important');
          });
        }
      }());
    </script>
  </body>
</html>